var Route,Router,parsePath,parseQuery,pathname;Router=function(){function t(){this.routes=[],this.params={},this.paramsExp={},this.prefix="",makeEventEmitter(this)}return t.prototype.param=function(t,r){if(!("function"==typeof r||r instanceof RegExp))throw new Error('param must have a callback of type "function" or RegExp. Got '+r+".");return"function"==typeof r?(this.params[t]||(this.params[t]=[])).push(r):this.paramsExp[t]=r,this},t.prototype.route=function(t,r){if("function"!=typeof r)throw new Error('route must have a callback of type "function". Got '+r+".");return"string"==typeof t&&(t="/"+t,t=t.replace(/\/{2,}/g,"/")),this.routes.push(new Route(t,r)),this},t.prototype.redirect=function(t,r){var e,n,a;return null==r&&(r=!1),"."===t.charAt(0)||t.split("//").length>1?(a=document.createElement("a"),a.href=t,t=pathname(a)+a.search):t=this.prefix+t,this.currentUrl!==t?!this.hashOnly&&this.root&&0!==t.indexOf(this.root)?void(location.href=t):(n=!1,this.on("error",e=function(t){return"notFound"===t?n=!0:void 0}),this.usePushState?(r?history.replaceState({},"",t):history.pushState({},"",t),this.currentUrl=t,this.dispatch(t)):(this.hashOnly||(t=t.replace(this.root,""),"/"!==t.charAt(0)&&(t="/"+t)),location.hash="/"===t?"":"#"+t),this.off("error",e),!n):void 0},t.prototype.listen=function(t){var r,e,n;return null==t&&(t={}),t.stop?(this._handleChange&&$(window).off("popstate hashChange",this._handleChange),this):(null!=t.root&&(this.root=t.root),null!=t.prefix&&(this.prefix=t.prefix),null!=t.hashOnly&&(this.hashOnly=t.hashOnly),this.usePushState=!this.hashOnly&&null!=(null!=(e=window.history)?e.pushState:void 0),null!=this.root||this.usePushState||(this.hashOnly=!0),this.hashOnly&&(this.prefix=""),r=null,this._handleChange=function(t){return function(){var e;return e=r(),t.currentUrl!==e?(t.currentUrl=e,t.dispatch(e)):void 0}}(this),this.usePushState?(location.hash&&(n=location.pathname.replace(/\/$/,"")+location.hash.replace(/^#?\/?/,"/"),history.replaceState({},"",n)),r=function(){return location.pathname+location.search},$(window).on("popstate",this._handleChange)):(r=function(t){return function(){return location.hash?location.hash.replace(/^#\/?/,"/"):location.pathname+location.search}}(this),$(window).on("hashchange",this._handleChange)),this._handleChange(),this)},t.prototype.getUrlParts=function(t){var r,e;return e=document.createElement("a"),e.href=t,r=pathname(e),0!==r.indexOf(this.prefix)?null:(r=r.replace(this.prefix,""),"/"!==r.charAt(0)&&(r="/"+r),{path:r,query:e.search})},t.prototype.getRoutesMatchingPath=function(t){return null==t?[]:this.routes.filter(function(r){return function(e){var n,a,h;if(!e.match(t))return!1;a=e.params;for(n in a)if(h=a[n],r.paramsExp[n]&&!r.paramsExp[n].test(h))return!1;return!0}}(this))},t.prototype.dispatch=function(t){var r,e,n,a,h,o;return(o=this.getUrlParts(t))?(n=o.path,a={url:t,path:n,query:parseQuery(o.query)},this.trigger("change",[n]),h=this.getRoutesMatchingPath(n),r=[],h.forEach(function(t){return function(e){var n,a,h;r.push(function(t,r){return t.params=e.params,r()}),a=e.params;for(n in a)h=a[n],t.params[n]&&r.push.apply(r,t.params[n]);return r.push(e.callback)}}(this)),e=function(t){return function(n){var h;return n?t.trigger("error",[n]):0===r.length?e("notFound"):(h=r.shift())(a,e)}}(this),0===r.length?e("notFound"):e(),this):void 0},t}(),chip.Router=Router,Route=function(){function t(t,r){this.path=t,this.callback=r,this.keys=[],this.expr=parsePath(t,this.keys)}return t.prototype.match=function(t){var r,e,n,a,h,o;if(!(h=this.expr.exec(t)))return!1;for(this.params={},r=e=0,a=h.length;a>e;r=++e)o=h[r],0!==r&&(n=this.keys[r-1],"string"==typeof o&&(o=decodeURIComponent(o)),n||(n="*"),this.params[n]=o);return!0},t}(),chip.Route=Route,parsePath=function(t,r){return t instanceof RegExp?t:(Array.isArray(t)&&(t="("+t.join("|")+")"),t=t.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,e,n,a,h,o,i){var s;return r.push(a),e=e||"",s="",o||(s+=e),s+="(?:",o&&(s+=e),s+=n||"",s+=h||(n&&"([^/.]+?)"||"([^/]+?)")+")",s+=o||"",i&&(s+="(/*)?"),s}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$","i"))},parseQuery=function(t){var r;return r={},""===t?r:(t.replace(/^\?/,"").split("&").forEach(function(t){var e,n,a;return n=t.split("="),e=n[0],a=n[1],r[decodeURIComponent(e)]=decodeURIComponent(a)}),r)},pathname=function(t){var r;return r=t.pathname,"/"!==r.charAt(0)&&(r="/"+r),r};